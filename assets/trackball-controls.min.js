THREE.TrackballControls=function(e,t){var n=this,o={NONE:-1,ROTATE:2,ZOOM:1,PAN:0,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.7,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var i=new THREE.Vector3,s=o.NONE,c=o.NONE,a=new THREE.Vector3,p=new THREE.Vector2,r=new THREE.Vector2,d=new THREE.Vector3,h=0,E=new THREE.Vector2,u=new THREE.Vector2,m=0,y=0,v=new THREE.Vector2,l=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var g={type:"change"},T={type:"start"},w={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var b,f,O,R,H,L,V,k,B,N,j,A,Y=(b=new THREE.Vector2,function(e,t){return b.set((e-n.screen.left)/n.screen.width,(t-n.screen.top)/n.screen.height),b}),C=(f=new THREE.Vector2,function(e,t){return f.set((e-.5*n.screen.width-n.screen.left)/(.5*n.screen.width),(n.screen.height+2*(n.screen.top-t))/n.screen.width),f});function P(e){!1!==n.enabled&&(window.removeEventListener("keydown",P,eventBindType),c=s,s===o.NONE&&(e.keyCode!==n.keys[o.ROTATE]||n.noRotate?e.keyCode!==n.keys[o.ZOOM]||n.noZoom?e.keyCode!==n.keys[o.PAN]||n.noPan||(s=o.PAN):s=o.ZOOM:s=o.ROTATE))}function X(e){!1!==n.enabled&&(s=c,window.addEventListener("keydown",P,eventBindType))}function D(e){!1!==n.enabled&&(s===o.NONE&&(s=e.button),s!==o.ROTATE||n.noRotate?s!==o.ZOOM||n.noZoom?s!==o.PAN||n.noPan||(v.copy(Y(e.pageX,e.pageY)),l.copy(v)):(E.copy(Y(e.pageX,e.pageY)),u.copy(E)):(r.copy(C(e.pageX,e.pageY)),p.copy(r)),document.addEventListener("mousemove",M,eventBindType),document.addEventListener("mouseup",S,eventBindType),n.dispatchEvent(T))}function M(e){!1!==n.enabled&&(s!==o.ROTATE||n.noRotate?s!==o.ZOOM||n.noZoom?s!==o.PAN||n.noPan||l.copy(Y(e.pageX,e.pageY)):u.copy(Y(e.pageX,e.pageY)):(p.copy(r),r.copy(C(e.pageX,e.pageY))))}function S(e){!1!==n.enabled&&(s=o.NONE,document.removeEventListener("mousemove",M,eventBindType),document.removeEventListener("mouseup",S,eventBindType),n.dispatchEvent(w))}function Z(e){if(!1!==n.enabled){switch(e.deltaMode){case 2:E.y-=.025*e.deltaY;break;case 1:E.y-=.01*e.deltaY;break;default:E.y-=25e-5*e.deltaY}n.dispatchEvent(T),n.dispatchEvent(w)}}function x(e){if(!1!==n.enabled){switch(e.touches.length){case 1:s=o.TOUCH_ROTATE,r.copy(C(e.touches[0].pageX,e.touches[0].pageY)),p.copy(r);break;default:s=o.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;y=m=Math.sqrt(t*t+i*i);var c=(e.touches[0].pageX+e.touches[1].pageX)/2,a=(e.touches[0].pageY+e.touches[1].pageY)/2;v.copy(Y(c,a)),l.copy(v)}n.dispatchEvent(T)}}function z(e){if(!1!==n.enabled)switch(e.touches.length){case 1:p.copy(r),r.copy(C(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;y=Math.sqrt(t*t+o*o);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,s=(e.touches[0].pageY+e.touches[1].pageY)/2;l.copy(Y(i,s))}}function _(e){if(!1!==n.enabled){switch(e.touches.length){case 0:s=o.NONE;break;case 1:s=o.TOUCH_ROTATE,r.copy(C(e.touches[0].pageX,e.touches[0].pageY)),p.copy(r)}n.dispatchEvent(w)}}function q(e){!1!==n.enabled&&e.preventDefault()}this.rotateCamera=(R=new THREE.Vector3,H=new THREE.Quaternion,L=new THREE.Vector3,V=new THREE.Vector3,k=new THREE.Vector3,B=new THREE.Vector3,function(){B.set(r.x-p.x,r.y-p.y,0),(O=B.length())?(a.copy(n.object.position).sub(n.target),L.copy(a).normalize(),V.copy(n.object.up).normalize(),k.crossVectors(V,L).normalize(),V.setLength(r.y-p.y),k.setLength(r.x-p.x),B.copy(V.add(k)),R.crossVectors(B,a).normalize(),O*=n.rotateSpeed,H.setFromAxisAngle(R,O),a.applyQuaternion(H),n.object.up.applyQuaternion(H),d.copy(R),h=O):!n.staticMoving&&h&&(h*=Math.sqrt(1-n.dynamicDampingFactor),a.copy(n.object.position).sub(n.target),H.setFromAxisAngle(d,h),a.applyQuaternion(H),n.object.up.applyQuaternion(H)),p.copy(r)}),this.zoomCamera=function(){var e;s===o.TOUCH_ZOOM_PAN?(e=m/y,m=y,a.multiplyScalar(e)):(1!==(e=1+(u.y-E.y)*n.zoomSpeed)&&e>0&&a.multiplyScalar(e),n.staticMoving?E.copy(u):E.y+=(u.y-E.y)*this.dynamicDampingFactor)},this.panCamera=(N=new THREE.Vector2,j=new THREE.Vector3,A=new THREE.Vector3,function(){N.copy(l).sub(v),N.lengthSq()&&(N.multiplyScalar(a.length()*n.panSpeed),A.copy(a).cross(n.object.up).setLength(N.x),A.add(j.copy(n.object.up).setLength(N.y)),n.object.position.add(A),n.target.add(A),n.staticMoving?v.copy(l):v.add(N.subVectors(l,v).multiplyScalar(n.dynamicDampingFactor)))}),this.checkDistances=function(){n.noZoom&&n.noPan||(a.lengthSq()>n.maxDistance*n.maxDistance&&(n.object.position.addVectors(n.target,a.setLength(n.maxDistance)),E.copy(u)),a.lengthSq()<n.minDistance*n.minDistance&&(n.object.position.addVectors(n.target,a.setLength(n.minDistance)),E.copy(u)))},this.update=function(){a.subVectors(n.object.position,n.target),n.noRotate||n.rotateCamera(),n.noZoom||n.zoomCamera(),n.noPan||n.panCamera(),n.object.position.addVectors(n.target,a),n.checkDistances(),n.object.lookAt(n.target),i.distanceToSquared(n.object.position)>1e-6&&(n.dispatchEvent(g),i.copy(n.object.position))},this.reset=function(){s=o.NONE,c=o.NONE,n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.up.copy(n.up0),a.subVectors(n.object.position,n.target),n.object.lookAt(n.target),n.dispatchEvent(g),i.copy(n.object.position)},this.dispose=function(){this.domElement.removeEventListener("contextmenu",q,eventBindType),this.domElement.removeEventListener("mousedown",D,eventBindType),this.domElement.removeEventListener("wheel",Z,eventBindType),this.domElement.removeEventListener("touchstart",x,eventBindType),this.domElement.removeEventListener("touchend",_,eventBindType),this.domElement.removeEventListener("touchmove",z,eventBindType),document.removeEventListener("mousemove",M,eventBindType),document.removeEventListener("mouseup",S,eventBindType),window.removeEventListener("keydown",P,eventBindType),window.removeEventListener("keyup",X,eventBindType)},this.domElement.addEventListener("contextmenu",q,eventBindType),this.domElement.addEventListener("mousedown",D,eventBindType),this.domElement.addEventListener("wheel",Z,eventBindType),this.domElement.addEventListener("touchstart",x,eventBindType),this.domElement.addEventListener("touchend",_,eventBindType),this.domElement.addEventListener("touchmove",z,eventBindType),window.addEventListener("keydown",P,eventBindType),window.addEventListener("keyup",X,eventBindType),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls;var supportsPassive=!1;try{var opts=Object.defineProperty({},"passive",{get:function(){supportsPassive=!0}});window.addEventListener("testPassive",null,opts),window.removeEventListener("testPassive",null,opts)}catch(e){}var eventBindType=!!supportsPassive&&{passive:!0};
